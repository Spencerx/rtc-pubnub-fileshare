<!DOCTYPE html>
<html lang="en">
<head>
    <title>RTC PubNub Guide</title>
    <link rel="stylesheet" href="./flat-ui/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="./flat-ui/css/flat-ui.css" />
    <link rel="stylesheet" href="google-code-prettify/prettify.css" />
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <!-----------------------------------------------
     ! INTRODUCTION AND VIDEO                       !
     !----------------------------------------------->
    <div class="heading palette palette-turquoise">
        <h2 class="page-title">RTC PubNub Guide</h2>
    </div>
    <div class="row-fluid">
        <div class="span5 panel">
            <p class="lead">
                Welcome to the RTC PubNub how-to guide. This page is dedicated to providing a
                bit of insight into how we built the PubShare demo. As you can see, the actual
                demo app is embedded in this page so you can conveniently interact with it
                as you need while looking over the guide.
                <br />
                <br />
                The PubShare demo was created using PubNub and the WebRTC DataChannel via
                PubNub's new beta WebRTC API. As you may know already, PubNub allows
                developers to quickly enable their applications with real-time communication
                capabilities with minimal effort. But certain scenarios require lower latency
                and more data throughput than is economically feasible with vanilla PubNub.
                So we've continued the ease-of-use that comes with PubNub and made our WebRTC
                API simple to use, especially if you're already familiar with the PubNub
                JavaScript API.
            </p>
        </div>
        <div class="span7 panel palette-clouds">
            <div class="video-container palette-wet-asphalt centered c-text">
                YouTube Video
            </div>
        </div>
    </div>

    <!-----------------------------------------------
     ! EMBEDDED DEMO APPS                           !
     !----------------------------------------------->
    <div class="row-fluid palette-asbestos">
        <div class="span6" style="border-right: solid 1px black;">
            <iframe class="app-frame" src="http://tskimmett.github.io/rtc-pubnub-fileshare" seamless="seamless"></iframe>
        </div>
        <div class="span6" style="border-left: solid 1px black;">
            <iframe class="app-frame" src="http://tskimmett.github.io/rtc-pubnub-fileshare" seamless="seamless"></iframe>
        </div>
    </div>

    <!-----------------------------------------------
     ! SETTING UP PUBNUB LIBRARIES                  !
     !----------------------------------------------->
    <div class="heading palette palette-peter-river r-text">
        <!--<iframe src="http://ghbtns.com/github-btn.html?user=pubnub&repo=webrtc&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>-->
        <h2 class="page-title">Setup</h2>
    </div>
    <div class="row-fluid palette-silver">
        <div class="span7 panel palette-clouds">
            <h3>Download on GitHub...</h3>
            <a href="https://github.com/pubnub/webrtc" target="_blank" id="git-page-img-cont" class="mbl"></a>
            <div>
                <h3>...include in your page</h3>
                <pre class="prettyprint">
        &lt;script src="http://cdn.pubnub.com/pubnub-3.5.1.min.js"&gt;&lt;/script&gt;
        &lt;script src="./webrtc-beta-pubnub.js"&gt;&lt;/script&gt;</pre>
            </div>
        </div>
        <div class="span5 panel">
            <p>
                The official PubNub JavaScript API is available most easily from our CDN. But the
                beta WebRTC API is <a href="https://github.com/pubnub/webrtc">only available on GitHub</a>
                at the moment due to its ongoing development and the rapidly changing nature of WebRTC itself.
                <br />
                <br />
                To the left you can see how to include PubNub and the beta API. Note that
                the normal PubNub include comes before you include the API you downloaded
                from GitHub. This is to avoid any dependency issues.
                <br />
                <br />
                And just in case you were wondering, we used a couple of other tools for mainly
                UI work: <a target="_blank" href="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js">jQuery</a>
                and <a target="_blank" href="http://underscorejs.org/underscore-min.js">underscore.js</a>.
            </p>

        </div>
    </div>

    <!------------------------------------------------------------------
     ! HOW WE USE PUBNUB FOR SHARE SIGNALING, PRESENCE, AND WEBRTC API !
     !------------------------------------------------------------------>
    <div class="heading palette palette-wisteria">
        <h2 class="page-title">Using the API</h2>
    </div>
    <div class="row-fluid palette-concrete">
        <div class="span5">

            <!------------------------------------------------------------------
             ! DESCRIBE WHAT PUBNUB IS USED FOR                                !
             !------------------------------------------------------------------>
            <div class="panel palette-clouds">
                <p>
                    In the PubShare demo, PubNub is used in a few different places:
                </p>
                <ol id="usageList" class="mar-bot">
                    <li><span>Presence to see who is joining/leaving the sharing room</span></li>
                    <li><span>Basic signaling to show when someone wants to share a file with you</span></li>
                    <li><span>Sending/receiving file data via WebRTC API</span></li>
                </ol>
            </div>

            <!------------------------------------------------------------------
             ! SHOW WHAT WE DO WITH NORMAL PUBNUB SUBSCRIBE/PRESENCE           !
             !------------------------------------------------------------------>
            <div class="panel">
                <h4>Normal PubNub subscribe for handling people coming and going, and share signaling:</h4>
                <div>
                    <pre class="prettyprint">pubnub.subscribe({
    channel: protocol.CHANNEL,
    callback: this.handleSignal.bind(this),
    presence: this.handlePresence.bind(this)
});</pre>
                    <div class="ib">
                        <pre class="prettyprint numbered">handlePresence: function (msg) {
    var conn = this.connections[msg.uuid];
    if (conn) {
        // Pass the message to specific contact/connection
        conn.handlePresence(msg);
    }
    else {
        // Create a new connection and update the UI list
    }
}</pre>
                        <div class="step-num"><span>1</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="span7 panel palette-silver">
            <!------------------------------------------------------------------
             ! SHOW HOW WE USE WEBRTC API                                      !
             !------------------------------------------------------------------>
            <div class="row-fluid">
                <div class="span5">
                    <p class="mtl panel">
                        Here you can see how we initiate the peer-to-peer connection for sending the actual
                        file data. Notice that the only difference from the normal PubNub subscribe is that
                        a <strong>user</strong> is specified instead of a normal <strong>channel</strong>.
                        <br />
                        <br />
                        We still pull down history just to make sure we get any messages
                        that might have been sent before we finished subscribing.
                    </p>
                    <div class="step-num"><span>2</span></div>
                    <pre class="prettyprint">handleSignal: function (msg) {
    if (msg.action === protocol.ANSWER) {
        console.log("THE OTHER PERSON IS READY");
        this.p2pSetup();
    }
    else if (msg.action === protocol.OFFER) {
        // Someone's ready to send a file.
        // Let user opt-in to receive file data
        // Update UI to indicate there is a file available
    }
    else if (msg.action === protocol.ERR_REJECT) {
        alert("Unable to communicate with " + this.email);
    }
    else if (msg.action === protocol.CANCEL) {
        alert(this.email + " cancelled the share.");
    }
}</pre>
                </div>
                <div class="span7">
                    <div class="mll">
                        <div class="step-num"><span>3</span></div>
                        <pre class="h-fit prettyprint">p2pSetup: function () {
    console.log("Setting up P2P...");
    this.pubnub.subscribe({
        user: this.id,  // Indicates P2P communication
        callback: this.onP2PMessage
    });
    this.pubnub.history({
        user: this.id,
        callback: function (messages) {
            messages = messages[0];
            messages.forEach(this.onP2PMessage.bind(this));
        }
    });
    this.shareStart = Date.now();
}</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="google-code-prettify/prettify.js" onload="prettyPrint();"></script>
</body>
</html>
